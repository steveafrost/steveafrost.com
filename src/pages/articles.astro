---
import { getCollection } from 'astro:content';
import MainLayout from '../layouts/MainLayout.astro';

const articles = await getCollection('articles', ({ data }) => !data.draft);
const sortedArticles = articles.sort(
  (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);

const formatDate = (date: Date) =>
  date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });

const getReadingTime = (body: string) => {
  const words = body.replace(/^---[\s\S]*?---/, '').trim().split(/\s+/).length;
  return Math.max(1, Math.ceil(words / 250));
};
---

<MainLayout title="Articles | Steve Frost" description="Technical articles and blog posts by Steve Frost.">
  <section class="pb-8">
    <h1 class="mb-8 text-3xl font-extrabold tracking-tight sm:text-4xl">
      <span class="relative inline-block">
        <span class="text-gradient">articles</span>
        <svg class="absolute -bottom-3 left-0 w-full text-coral-400/40" viewBox="0 0 100 10" fill="none" preserveAspectRatio="none" aria-hidden="true">
          <path d="M0 5c8.33-6 16.67 6 25 0s16.67 6 25 0 16.67 6 25 0 16.67 6 25 0" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" />
        </svg>
      </span>
    </h1>
    <p class="mb-12 max-w-2xl text-ctp-subtext0">
      Thoughts on web development, tools, and the craft of building software.
    </p>

    <ul class="space-y-6">
      {sortedArticles.map((article, i) => {
        const min = getReadingTime(article.body ?? '');

        return (
          <li style={`animation: slideUp 0.4s ease-out ${i * 60}ms both;`}>
            <a
              href={`/articles/${article.slug}`}
              class="group block rounded-xl border border-white/5 border-l-2 border-l-coral-400/40 bg-ctp-surface0/30 px-3 py-4 transition-all duration-300 hover:border-white/10 hover:border-l-coral-400 hover:bg-ctp-surface0/50"
            >
              <div class="flex flex-col gap-1 sm:flex-row sm:items-baseline sm:justify-between sm:gap-4">
                <h2 class="text-lg font-medium text-gradient-hover text-ctp-text transition-colors duration-300 group-hover:text-transparent">
                  {article.data.title}
                </h2>
                <time class="shrink-0 text-sm text-ctp-overlay0" datetime={article.data.date.toISOString()}>
                  {formatDate(article.data.date)}
                </time>
              </div>
              <span class="mt-2 inline-flex items-center gap-1.5 text-xs tabular-nums text-ctp-overlay0">
                <svg class="h-3.5 w-3.5" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                </svg>
                {min} min read
              </span>
            </a>
          </li>
        );
      })}
    </ul>
  </section>
</MainLayout>
